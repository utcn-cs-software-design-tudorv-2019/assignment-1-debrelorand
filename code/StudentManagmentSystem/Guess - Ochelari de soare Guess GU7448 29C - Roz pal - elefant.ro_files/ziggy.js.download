/**
 *
 */

(function () {
    /**
     *
     */
    var url = "//ziggy.antavo.com";

    /**
     * @param {Object} data
     * @returns {{w: Number, h: Number, u: string, a: *}}
     */
    var collect = function (data) {
        var result = {
            u: location.origin + location.pathname,
            w: window.screen.width,
            h: window.screen.height
        };

        for (var i in data || {}) {
            if (data.hasOwnProperty(i)) {
                result[i] = data[i];
            }
        }

        return result;
    };

    /**
     * @param {Object} data
     * @param {String=} prefix
     * @return {String}
     */
    var serialize = function (data, prefix) {
        var result = [], key, value;

        for (var property in data) {
            if (data.hasOwnProperty(property)) {
                key = prefix ? prefix + "[" + property + "]" : property;
                value = data[property];
                result.push(
                    "object" === typeof value
                        ? serialize(value, key)
                        : encodeURIComponent(key) + "=" + encodeURIComponent(value)
                );
            }
        }

        return result.join("&");
    };

    /**
     * @return {XMLHttpRequest}
     */
    var createXMLHttpRequest = function (method, url) {
        var request;

        if (window.XMLHttpRequest) {
            request = new XMLHttpRequest();
        } else if (window.ActiveXObject) {
            request = new ActiveXObject("Microsoft.XMLHTTP");
        } else {
            throw new Error("No XMLHttpRequest object found!");
        }

        request.open(method, url, true);
        return request;
    };

    /**
     * @type {{init: Window.Ziggy.init}}
     */
    window.Ziggy = window.Ziggy || {
        /**
         * @param {Object} data
         */
        init: function (data) {
            createXMLHttpRequest("GET", url + "?" + serialize(collect(data))).send();
        }
    };
})();
